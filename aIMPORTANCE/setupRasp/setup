D∆∞·ªõi ƒë√¢y m√¨nh **gi·∫£i th√≠ch r√µ c√°ch t·∫°o Access Point (AP) cho Raspberry Pi khi kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Wi-Fi**, ƒë·ªìng th·ªùi **cung c·∫•p lu√¥n m·∫´u giao di·ªán HTML + CSS theo ƒë√∫ng style b·∫°n g·ª≠i** ƒë·ªÉ l√†m captive portal c·∫•u h√¨nh Wi-Fi.

---

# ‚úÖ **1. C√°ch t·∫°o Access Point (AP) cho Raspberry Pi khi kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Wi-Fi**

M·ª•c ti√™u: Khi Rasp kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Wi-Fi ‚Üí t·ª± b·∫≠t AP ‚Üí ng∆∞·ªùi d√πng v√†o web portal ƒë·ªÉ nh·∫≠p SSID + Password.

## **A. C√†i ƒë·∫∑t g√≥i c·∫ßn thi·∫øt**

```bash
sudo apt update
sudo apt install hostapd dnsmasq
sudo systemctl unmask hostapd
sudo systemctl enable hostapd
```

## **B. C·∫•u h√¨nh IP tƒ©nh cho wlan0**

File:

```bash
sudo nano /etc/dhcpcd.conf
```

Th√™m:

```conf
interface wlan0
    static ip_address=192.168.4.1/24
    nohook wpa_supplicant
```

Restart:

```bash
sudo systemctl restart dhcpcd
```

## **C. C·∫•u h√¨nh DHCP cho AP**

Backup dnsmasq:

```bash
sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig
sudo nano /etc/dnsmasq.conf
```

Th√™m:

```conf
interface=wlan0
dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h
```

## **D. C·∫•u h√¨nh hostapd**

```bash
sudo nano /etc/hostapd/hostapd.conf
```

V√≠ d·ª•:

```conf
interface=wlan0
driver=nl80211
ssid=Raspberry-Setup
hw_mode=g
channel=7
wmm_enabled=0
auth_algs=1
wpa=2
wpa_passphrase=12345678
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
```

Tr·ªè hostapd:

```bash
sudo nano /etc/default/hostapd
```

Th√™m:

```
DAEMON_CONF="/etc/hostapd/hostapid.conf"
```

---

# ‚úÖ **2. Captive Portal ‚Äì d√πng lighttpd ho·∫∑c Flask**

B·∫°n c√≥ th·ªÉ d√πng:

* **Flask ch·∫°y Python** ‚Üí ti·ªán g·ª≠i SSID/password v√†o wpa_supplicant
* D√πng **lighttpd + CGI** ‚Üí ƒë∆°n gi·∫£n
* D√πng **Node.js Express** ‚Üí n·∫øu quen

D∆∞·ªõi ƒë√¢y m√¨nh l√†m b·∫£n **Flask** d·ªÖ t√πy bi·∫øn nh·∫•t.

---

# ‚úÖ **3. Giao di·ªán HTML theo ƒë√∫ng style CSS b·∫°n ƒë∆∞a**

## üëâ **B·∫°n ch·ªâ c·∫ßn t·∫°o file: `/var/www/html/index.html` (ho·∫∑c Flask template)**

### **HTML m·∫´u (r·∫•t ƒë·∫πp + ph√π h·ª£p CSS tr√™n)**

> ‚ö†Ô∏è Style b·∫°n ƒë∆∞a qu√° d√†i n√™n m√¨nh **kh√¥ng nh·∫Øc l·∫°i CSS**, b·∫°n ch·ªâ c·∫ßn copy ƒë√∫ng CSS c·ªßa b·∫°n v√†o `<style>‚Ä¶</style>`.

```html
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>C·∫•u h√¨nh Wi-Fi Raspberry Pi</title>

<!-- D√°n to√†n b·ªô CSS b·∫°n g·ª≠i v√†o ƒë√¢y -->
<style>
/* PASTE nguy√™n CSS c·ªßa b·∫°n ·ªü ƒë√¢y */
</style>
</head>

<body>
    <header class="app-header">
        <h2><span>üì∂</span> Thi·∫øt l·∫≠p Wi-Fi cho Raspberry Pi</h2>
        <div class="status-chip">Access Point Mode</div>
    </header>

    <div class="container">
        <div class="video-panel">
            <div class="video-wrapper">
                <span class="video-tag">Wi-Fi Setup</span>
                <p style="color:white">Kh√¥ng c√≥ video, ch·ªâ minh h·ªça layout</p>
            </div>
        </div>

        <div class="control-panel">
            <div class="section">
                <h3>üîß Nh·∫≠p th√¥ng tin Wi-Fi</h3>
                
                <div class="field">
                    <label>T√™n Wi-Fi (SSID)</label>
                    <input id="ssid" placeholder="V√≠ d·ª•: MyHomeWiFi">
                </div>

                <div class="field">
                    <label>M·∫≠t kh·∫©u</label>
                    <input id="password" type="password" placeholder="M·∫≠t kh·∫©u Wi-Fi">
                </div>

                <div class="btn-row">
                    <button onclick="saveWifi()">L∆∞u & K·∫øt n·ªëi</button>
                </div>

                <div class="log-box" id="log-area">
                    Nh·∫≠t k√Ω h·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y...
                </div>
            </div>
        </div>
    </div>

<script>
function saveWifi() {
    const ssid = document.getElementById("ssid").value;
    const password = document.getElementById("password").value;

    fetch("/api/save_wifi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ssid, password })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("log-area").innerText += "\n" + data.message;
    });
}
</script>

</body>
</html>
```

---

# ‚úÖ **4. Flask backend ‚Äì nh·∫≠n SSID/Password & ghi v√†o Raspberry Pi**

### File: `app.py`

```python
from flask import Flask, request, jsonify
import os

app = Flask(__name__)

WPA_FILE = "/etc/wpa_supplicant/wpa_supplicant.conf"

@app.post("/api/save_wifi")
def save_wifi():
    data = request.json
    ssid = data["ssid"]
    password = data["password"]

    wpa_config = f'''
network={{
    ssid="{ssid}"
    psk="{password}"
}}
'''

    with open(WPA_FILE, "a") as f:
        f.write(wpa_config)

    os.system("systemctl restart wpa_supplicant")
    return jsonify({"message": "ƒê√£ l∆∞u! Rasp ƒëang th·ª≠ k·∫øt n·ªëi Wi-Fi..."})
```

### Ch·∫°y server

```bash
pip install flask
sudo python3 app.py
```

---

# ‚úÖ **5. Logic ho·∫°t ƒë·ªông ho√†n ch·ªânh**

| Tr·∫°ng th√°i                         | H√†nh ƒë·ªông                     |
| ---------------------------------- | ----------------------------- |
| N·∫øu Wi-Fi **k·∫øt n·ªëi OK**           | Ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng         |
| N·∫øu Wi-Fi **kh√¥ng k·∫øt n·ªëi**        | Rasp t·ª± b·∫≠t AP + Flask portal |
| User truy c·∫≠p                      | `http://192.168.4.1`          |
| Nh·∫≠p SSID/Password                 | Ghi v√†o `wpa_supplicant.conf` |
| Rasp t·ª± t·∫Øt AP + th·ª≠ k·∫øt n·ªëi Wi-Fi | OK                            |

---

# üìå N·∫øu b·∫°n mu·ªën m√¨nh t·∫°o **b·∫£n ho√†n ch·ªânh d·∫°ng project ƒë·∫ßy ƒë·ªß th∆∞ m·ª•c**, ho·∫∑c t·∫°o **React/Web UI** ƒë·∫πp h∆°n theo style c·ªßa b·∫°n ‚Üí ch·ªâ c·∫ßn y√™u c·∫ßu m√¨nh!
